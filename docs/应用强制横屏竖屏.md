# iOS方向控制 - 项目配置方式

## 问题描述
在iOS开发中，有时需要强制应用只支持竖屏或横屏。传统方法可能需要修改多个文件，但现代SwiftUI应用有更简单的方式。

## 解决方案

### 方法1：修改项目配置文件（推荐）
在`EyeSee.xcodeproj/project.pbxproj`中修改`INFOPLIST_KEY_UISupportedInterfaceOrientations_iPhone`：

```bash
# 修改前（支持竖屏和横屏）
INFOPLIST_KEY_UISupportedInterfaceOrientations_iPhone = "UIInterfaceOrientationPortrait UIInterfaceOrientationLandscapeLeft UIInterfaceOrientationLandscapeRight";

# 修改后（仅支持竖屏）
INFOPLIST_KEY_UISupportedInterfaceOrientations_iPhone = "UIInterfaceOrientationPortrait";
```

### 方法2：修改Info.plist（等效）
如果项目使用Info.plist文件，可以添加：
```xml
<key>UISupportedInterfaceOrientations</key>
<array>
    <string>UIInterfaceOrientationPortrait</string>
</array>
```

## 为什么这种方式有效？

### iOS的方向控制机制

1. **项目配置层（最优先）**
   - `UISupportedInterfaceOrientations`是应用级别的"白名单"
   - 系统在启动时就检查这个配置
   - 这是最高级别的限制

2. **系统行为**
   当应用启动时，iOS会：
   - 读取Info.plist中的`UISupportedInterfaceOrientations`
   - 如果只指定了`UIInterfaceOrientationPortrait`，系统会：
     - 禁止横屏旋转
     - 忽略设备的旋转事件
     - 强制状态栏为竖屏
     - 强制所有界面为竖屏

3. **SwiftUI的简化机制**
   - SwiftUI应用由`WindowGroup`管理
   - 系统会自动遵循项目配置
   - 不需要额外的代码处理

## 传统方式 vs 现代方式

### 传统方式（iOS 13之前）
```swift
// AppDelegate中需要实现
func application(_ application: UIApplication, supportedInterfaceOrientationsFor window: UIWindow?) -> UIInterfaceOrientationMask {
    return .portrait
}

// 每个ViewController也需要
override var supportedInterfaceOrientations: UIInterfaceOrientationMask {
    return .portrait
}
```

### 现代iOS（iOS 14+）SwiftUI
- 只需要修改项目配置
- SwiftUI的`@Environment(\.horizontalSizeClass)`等会自动适应
- `WindowGroup`会自动遵循系统设置

## 适用场景

### 仅需修改项目配置的情况
- 纯SwiftUI应用
- 没有UIKit ViewController混合使用
- 所有页面都需要相同的方向限制
- 使用`WindowGroup`作为根视图

### 需要额外处理的情况
- UIKit ViewController混合使用
- 特定页面需要不同方向（如视频播放需要横屏）
- 自定义Delegate处理方向
- 复杂的导航结构

## 实际案例

EyeSee项目的情况：
- 纯SwiftUI应用
- 没有自定义方向处理代码
- 使用`WindowGroup`作为根视图
- 相机应用需要固定竖屏

结论：只需要修改项目配置即可实现强制竖屏。

## 相关API

### iOS 17+ 摄像头方向相关
- 已弃用：`videoOrientation`、`isVideoOrientationSupported`
- 新API：`videoRotationAngle`、`isVideoRotationAngleSupported(_:)`

```swift
// 旧API（iOS 17已弃用）
connection.videoOrientation = .portrait
if connection.isVideoOrientationSupported {
    // 处理方向
}

// 新API（iOS 17+推荐）
if connection.isVideoRotationAngleSupported(0) {
    connection.videoRotationAngle = 0 // 竖屏方向
}
```

## 总结

对于现代SwiftUI应用，项目配置是最简单、最可靠的方向控制方式。只有在需要更复杂方向控制逻辑时，才需要额外的代码处理。

**优先级：项目配置 > 系统默认 > 代码处理**